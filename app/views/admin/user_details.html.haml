:javascript
  function select_all(ids, select) {
    while(ids.length > 0) {
      $( "#permission_" + ids.shift() + "_" + select ).attr('checked', true);
    }
  }

%header
  %h1 Nutzerdaten bearbeiten
- if @user.blank?
  %p
    Dieser Nutzer existiert nicht.
- else
  %p
    = "Rechtevergabe f&uuml;r #{@user.name}"
  - form_tag set_permissions_path, :name => 'set_permissions' do
    %fieldset
      %legend Rechtevergabe
      .fieldset-desc
        %p
          Bitte wählen Sie die Rechte für diesen Nutzer aus.
      = hidden_field(:user, :id)
      - @permissions.sort.each do |source,tables|
        %h3
          = source.capitalize
        - tables.sort.each do |table,columns|
          %div.accordion
            %h3
              %a{:href => '#'}
                = table.capitalize
            %div
              %table
                %tr
                  %td
                    &nbsp;
                  %td{:style => 'text-align:center;'}
                    Lesen
                  %td{:style => 'text-align:center;'}
                    Erstellen
                  %td{:style => 'text-align:center;'}
                    Ändern
                  %td{:style => 'text-align:center;'}
                    Löschen
                - columns.sort.each do |column, accesses|
                  %tr
                    %td{:style => 'width:40%;'}
                      = column
                    - %w[read create update delete].each do |access|
                      %td{:style => 'width:15%;text-align:center;'}
                        - unless accesses[access].nil?
                          - if @user_permissions.reject! {|p| p.source == source and p.table == table and p.column == column and p.access == access}
                            %input{:type => "checkbox", :name => "permissions[#{accesses[access]}]", :checked => true}
                          - else
                            %input{:type => "checkbox", :name => "permissions[#{accesses[access]}]"}
                        - else
                          &nbsp;

      %button{:name => 'commit', :type => 'submit'} Absenden
    
  - key_confirm_function = "return confirm('Wollen Sie den API-Key des Nutzers wirklich erneuern?')" 
  - form_tag reset_apikey_path, :name => 'reset_apikey', :onsubmit => key_confirm_function do
    %fieldset
      %legend
        = "API-Key für #{@user.name} zurücksetzen"
      .fieldset-desc
        %p
          Mit einem Klick auf Absenden wird der API-Key des Nutzers erneuert. Der Nutzer muss dar&uuml;ber in Kenntnis gesetzt werden,
          da sein alter API-Key dann nicht mehr funktioniert.
      = hidden_field :user, :id
      %button{:name => 'commit', :type => 'submit'} API-Key erneuern

  - deactivate_confirm_function = "return confirm('Wollen Sie den Nutzer wirklich deaktivieren?')" 
  - form_tag user_deactivation_path, :name => 'deactivation', :onsubmit => deactivate_confirm_function do
    %fieldset
      %legend
        = "Account von #{@user.name} deaktivieren"
      .fieldset-desc
        %p
          Mit einem Klick auf Absenden wird der Nutzer deaktiviert. Der Nutzer hat dann keinen Zugang mehr zur Leipzig-API.
          Seine Rechte bleiben bis zur einer erneuten Aktivierung erhalten.
      = hidden_field :user, :id
      %button{:name => 'commit', :type => 'submit'} Deaktivieren
