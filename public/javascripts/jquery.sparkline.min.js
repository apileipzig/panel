(function(h){function y(b,a){if(a==2){var c=Math.floor(b.length/2);return b.length%2?b[c]:(b[c]+b[c+1])/2}else{c=Math.floor(b.length/4);return b.length%2?(b[c*a]+b[c*a+1])/2:b[c*a]}}h.fn.simpledraw=function(b,a,c){if(c&&this[0].vcanvas)return this[0].vcanvas;if(b==undefined)b=h(this).innerWidth();if(a==undefined)a=h(this).innerHeight();return h.browser.hasCanvas?new B(b,a,this):h.browser.msie?new C(b,a,this):false};var x=[];h.fn.sparkline=function(b,a){a=h.extend({type:"line",lineColor:"#00f",fillColor:"#cdf",
defaultPixelsPerValue:3,width:"auto",height:"auto",composite:false},a?a:{});return this.each(function(){var c=function(){var d=b=="html"||b==undefined?h(this).text().split(","):b,f=a.width=="auto"?d.length*a.defaultPixelsPerValue:a.width;if(a.height=="auto"){if(!a.composite||!this.vcanvas){var e=document.createElement("span");e.innerHTML="a";h(this).html(e);height=h(e).innerHeight();h(e).remove()}}else height=a.height;h.fn.sparkline[a.type].call(this,d,a,f,height)};h(this).html()&&h(this).is(":hidden")||
h.fn.jquery<"1.3.0"&&h(this).parents().is(":hidden")?x.push([this,c]):c.call(this)})};h.sparkline_display_visible=function(){for(var b=x.length-1;b>=0;b--){var a=x[b][0];if(h(a).is(":visible")&&!h(a).parents().is(":hidden")){x[b][1].call(a);x.splice(b,1)}}};h.fn.sparkline.line=function(b,a,c,d){a=h.extend({spotColor:"#f80",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:"#ccc",chartRangeMin:undefined,chartRangeMax:undefined,
chartRangeMinX:undefined,chartRangeMaxX:undefined},a?a:{});var f=[],e=[],g=[];for(n=0;n<b.length;n++){var j=typeof b[n]=="string",q=typeof b[n]=="object"&&b[n]instanceof Array,k=j&&b[n].split(":");if(j&&k.length==2){f.push(Number(k[0]));e.push(Number(k[1]));g.push(Number(k[1]))}else if(q){f.push(b[n][0]);e.push(b[n][1]);g.push(b[n][1])}else{f.push(n);if(b[n]===null||b[n]=="null")e.push(null);else{e.push(Number(b[n]));g.push(Number(b[n]))}}}if(a.xvalues)f=a.xvalues;j=b=Math.max.apply(Math,g);q=g=Math.min.apply(Math,
g);n=Math.max.apply(Math,f);k=Math.min.apply(Math,f);if(a.normalRangeMin!=undefined){if(a.normalRangeMin<g)g=a.normalRangeMin;if(a.normalRangeMax>b)b=a.normalRangeMax}if(a.chartRangeMin!=undefined&&(a.chartRangeClip||a.chartRangeMin<g))g=a.chartRangeMin;if(a.chartRangeMax!=undefined&&(a.chartRangeClip||a.chartRangeMax>b))b=a.chartRangeMax;if(a.chartRangeMinX!=undefined&&(a.chartRangeClipX||a.chartRangeMinX<k))k=a.chartRangeMinX;if(a.chartRangeMaxX!=undefined&&(a.chartRangeClipX||a.chartRangeMaxX>
n))n=a.chartRangeMaxX;var o=n-k==0?1:n-k,l=b-g==0?1:b-g,m=e.length-1;if(m<1)this.innerHTML="";else if(c=h(this).simpledraw(c,d,a.composite)){var r=c.pixel_width,p=c.pixel_height,t=0,s=0;if(a.spotRadius&&(r<a.spotRadius*4||p<a.spotRadius*4))a.spotRadius=0;if(a.spotRadius){if(a.minSpotColor||a.spotColor&&e[m]==g)p-=Math.ceil(a.spotRadius);if(a.maxSpotColor||a.spotColor&&e[m]==b){p-=Math.ceil(a.spotRadius);t+=Math.ceil(a.spotRadius)}if(a.minSpotColor||a.maxSpotColor&&(e[0]==g||e[0]==b)){s+=Math.ceil(a.spotRadius);
r-=Math.ceil(a.spotRadius)}if(a.spotColor||a.minSpotColor||a.maxSpotColor&&(e[m]==g||e[m]==b))r-=Math.ceil(a.spotRadius)}p--;if(a.normalRangeMin!=undefined){n=t+Math.round(p-p*((a.normalRangeMax-g)/l));d=Math.round(p*(a.normalRangeMax-a.normalRangeMin)/l);c.drawRect(s,n,r,d,undefined,a.normalRangeColor)}d=[];for(var z=[d],n=0,A=e.length;n<A;n++){var v=f[n],w=e[n];if(w===null){if(n)if(e[n-1]!==null){d=[];z.push(d)}}else{if(w<g)w=g;if(w>b)w=b;d.length||d.push([s+Math.round((v-k)*(r/o)),t+p]);d.push([s+
Math.round((v-k)*(r/o)),t+Math.round(p-p*((w-g)/l))])}}n=0;for(A=z.length;n<A;n++){d=z[n];if(d.length){if(a.fillColor){d.push([d[d.length-1][0],t+p-1]);c.drawShape(d,undefined,a.fillColor);d.pop()}if(d.length>2)d[0]=[d[0][0],d[1][1]];c.drawShape(d,a.lineColor,undefined,a.lineWidth)}}a.spotRadius&&a.spotColor&&c.drawCircle(s+Math.round(f[f.length-1]*(r/o)),t+Math.round(p-p*((e[m]-g)/l)),a.spotRadius,undefined,a.spotColor);if(b!=q){if(a.spotRadius&&a.minSpotColor){v=f[e.indexOf(q)];c.drawCircle(s+Math.round((v-
k)*(r/o)),t+Math.round(p-p*((q-g)/l)),a.spotRadius,undefined,a.minSpotColor)}if(a.spotRadius&&a.maxSpotColor){v=f[e.indexOf(j)];c.drawCircle(s+Math.round((v-k)*(r/o)),t+Math.round(p-p*((j-g)/l)),a.spotRadius,undefined,a.maxSpotColor)}}}else this.innerHTML=""};h.fn.sparkline.bar=function(b,a,c,d){a=h.extend({type:"bar",barColor:"#00f",negBarColor:"#f44",zeroColor:undefined,nullColor:undefined,zeroAxis:undefined,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false,
colorMap:undefined},a?a:{});c=b.length*a.barWidth+(b.length-1)*a.barSpacing;for(var f=[],e=0,g=b.length;e<g;e++)if(b[e]=="null"||b[e]===null)b[e]=null;else{b[e]=Number(b[e]);f.push(Number(b[e]))}var j=Math.max.apply(Math,f);f=Math.min.apply(Math,f);if(a.chartRangeMin!=undefined&&(a.chartRangeClip||a.chartRangeMin<f))f=a.chartRangeMin;if(a.chartRangeMax!=undefined&&(a.chartRangeClip||a.chartRangeMax>j))j=a.chartRangeMax;if(a.zeroAxis==undefined)a.zeroAxis=f<0;var q=j-f==0?1:j-f;if(h.isArray(a.colorMap))var k=
a.colorMap,o=null;else{k=null;o=a.colorMap}if(c=h(this).simpledraw(c,d,a.composite)){var l=c.pixel_height,m=f<0&&a.zeroAxis?l-Math.round(l*(Math.abs(f)/q))-1:l-1;e=0;for(g=b.length;e<g;e++){var r=e*(a.barWidth+a.barSpacing),p=b[e];if(p===null)if(a.nullColor){s=a.nullColor;d=1;var t=a.zeroAxis&&f<0?m:l-d}else continue;else{if(p<f)p=f;if(p>j)p=j;var s=p<0?a.negBarColor:a.barColor;if(a.zeroAxis&&f<0){d=Math.round(l*(Math.abs(p)/q))+1;t=p<0?m:m-d}else{d=Math.round(l*((p-f)/q))+1;t=l-d}if(p==0&&a.zeroColor!=
undefined)s=a.zeroColor;if(o&&o[p])s=o[p];else if(k&&k.length>e)s=k[e];if(s===null)continue}c.drawRect(r,t,a.barWidth-1,d-1,s,s)}}else this.innerHTML=""};h.fn.sparkline.tristate=function(b,a,c,d){b=h.map(b,Number);a=h.extend({barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{}},a);c=b.length*a.barWidth+(b.length-1)*a.barSpacing;if(h.isArray(a.colorMap))var f=a.colorMap,e=null;else{f=null;e=a.colorMap}if(c=h(this).simpledraw(c,d,a.composite))for(var g=Math.round(c.pixel_height/
2),j=0,q=b.length;j<q;j++){var k=j*(a.barWidth+a.barSpacing);if(b[j]<0){var o=g;d=g-1;var l=a.negBarColor}else if(b[j]>0){o=0;d=g-1;l=a.posBarColor}else{o=g-1;d=2;l=a.zeroBarColor}if(e&&e[b[j]])l=e[b[j]];else if(f&&f.length>j)l=f[j];l!==null&&c.drawRect(k,o,a.barWidth-1,d-1,l,l)}else this.innerHTML=""};h.fn.sparkline.discrete=function(b,a,c,d){b=h.map(b,Number);a=h.extend({lineHeight:"auto",thresholdColor:undefined,thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false},
a);c=a.width=="auto"?b.length*2:c;var f=Math.floor(c/b.length);if(c=h(this).simpledraw(c,d,a.composite)){var e=c.pixel_height;d=a.lineHeight=="auto"?Math.round(e*0.3):a.lineHeight;e=e-d;var g=Math.min.apply(Math,b),j=Math.max.apply(Math,b);if(a.chartRangeMin!=undefined&&(a.chartRangeClip||a.chartRangeMin<g))g=a.chartRangeMin;if(a.chartRangeMax!=undefined&&(a.chartRangeClip||a.chartRangeMax>j))j=a.chartRangeMax;for(var q=j-g,k=0,o=b.length;k<o;k++){var l=b[k];if(l<g)l=g;if(l>j)l=j;var m=k*f,r=Math.round(e-
e*((l-g)/q));c.drawLine(m,r,m,r+d,a.thresholdColor&&l<a.thresholdValue?a.thresholdColor:a.lineColor)}}else this.innerHTML=""};h.fn.sparkline.bullet=function(b,a,c,d){b=h.map(b,Number);a=h.extend({targetColor:"red",targetWidth:3,performanceColor:"blue",rangeColors:["#D3DAFE","#A8B6FF","#7F94FF"],base:undefined},a);c=a.width=="auto"?"4.0em":c;if((c=h(this).simpledraw(c,d,a.composite))&&b.length>1){d=c.pixel_width-Math.ceil(a.targetWidth/2);var f=c.pixel_height,e=Math.min.apply(Math,b),g=Math.max.apply(Math,
b);e=a.base==undefined?e<0?e:0:a.base;g=g-e;i=2;for(vlen=b.length;i<vlen;i++){var j=parseInt(b[i]);c.drawRect(0,0,Math.round(d*((j-e)/g))-1,f-1,a.rangeColors[i-2],a.rangeColors[i-2])}j=parseInt(b[1]);c.drawRect(0,Math.round(f*0.3),Math.round(d*((j-e)/g))-1,Math.round(f*0.4)-1,a.performanceColor,a.performanceColor);b=parseInt(b[0]);j=Math.round(f*0.1);c.drawRect(Math.round(d*((b-e)/g)-a.targetWidth/2),j,a.targetWidth-1,f-j*2-1,a.targetColor,a.targetColor)}else this.innerHTML=""};h.fn.sparkline.pie=
function(b,a,c,d){b=h.map(b,Number);a=h.extend({sliceColors:["#f00","#0f0","#00f"]},a);c=a.width=="auto"?d:c;if((c=h(this).simpledraw(c,d,a.composite))&&b.length>1){d=Math.floor(Math.min(c.pixel_width,c.pixel_height)/2);for(var f=0,e=0,g=b.length;e<g;e++)f+=b[e];var j=0;if(a.offset)j+=2*Math.PI*(a.offset/360);var q=2*Math.PI;e=0;for(g=b.length;e<g;e++){var k=j,o=j;if(f>0)o=j+q*(b[e]/f);c.drawPieSlice(d,d,d,k,o,undefined,a.sliceColors[e%a.sliceColors.length]);j=o}}};h.fn.sparkline.box=function(b,a,
c,d){b=h.map(b,Number);a=h.extend({raw:false,boxLineColor:"black",boxFillColor:"#cdf",whiskerColor:"black",outlierLineColor:"#333",outlierFillColor:"white",medianColor:"red",showOutliers:true,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:"#4a2",chartRangeMax:undefined,chartRangeMin:undefined},a);c=a.width=="auto"?"4.0em":c;minvalue=a.chartRangeMin==undefined?Math.min.apply(Math,b):a.chartRangeMin;maxvalue=a.chartRangeMax==undefined?Math.max.apply(Math,b):a.chartRangeMax;if((c=h(this).simpledraw(c,
d,a.composite))&&b.length>1){var f=c.pixel_width;d=c.pixel_height;if(a.raw)if(a.showOutliers&&b.length>5)var e=b[0],g=b[1],j=b[2],q=b[3],k=b[4],o=b[5],l=b[6];else{g=b[0];j=b[1];q=b[2];k=b[3];o=b[4]}else{b.sort(function(r,p){return r-p});j=y(b,1);q=y(b,2);k=y(b,3);var m=k-j;if(a.showOutliers){o=g=undefined;e=0;for(l=b.length;e<l;e++){if(g==undefined&&b[e]>j-m*a.outlierIQR)g=b[e];if(b[e]<k+m*a.outlierIQR)o=b[e]}e=b[0];l=b[b.length-1]}else{g=b[0];o=b[b.length-1]}}b=f/(maxvalue-minvalue+1);m=0;if(a.showOutliers){m=
Math.ceil(a.spotRadius);f-=2*Math.ceil(a.spotRadius);b=f/(maxvalue-minvalue+1);e<g&&c.drawCircle((e-minvalue)*b+m,d/2,a.spotRadius,a.outlierLineColor,a.outlierFillColor);l>o&&c.drawCircle((l-minvalue)*b+m,d/2,a.spotRadius,a.outlierLineColor,a.outlierFillColor)}c.drawRect(Math.round((j-minvalue)*b+m),Math.round(d*0.1),Math.round((k-j)*b),Math.round(d*0.8),a.boxLineColor,a.boxFillColor);c.drawLine(Math.round((g-minvalue)*b+m),Math.round(d/2),Math.round((j-minvalue)*b+m),Math.round(d/2),a.lineColor);
c.drawLine(Math.round((g-minvalue)*b+m),Math.round(d/4),Math.round((g-minvalue)*b+m),Math.round(d-d/4),a.whiskerColor);c.drawLine(Math.round((o-minvalue)*b+m),Math.round(d/2),Math.round((k-minvalue)*b+m),Math.round(d/2),a.lineColor);c.drawLine(Math.round((o-minvalue)*b+m),Math.round(d/4),Math.round((o-minvalue)*b+m),Math.round(d-d/4),a.whiskerColor);c.drawLine(Math.round((q-minvalue)*b+m),Math.round(d*0.1),Math.round((q-minvalue)*b+m),Math.round(d*0.9),a.medianColor);if(a.target){f=Math.ceil(a.spotRadius);
c.drawLine(Math.round((a.target-minvalue)*b+m),Math.round(d/2-f),Math.round((a.target-minvalue)*b+m),Math.round(d/2+f),a.targetColor);c.drawLine(Math.round((a.target-minvalue)*b+m-f),Math.round(d/2),Math.round((a.target-minvalue)*b+m+f),Math.round(d/2),a.targetColor)}}else this.innerHTML=""};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b){for(var a=0,c=this.length;a<c;a++)if(this[a]==b)return a;return-1};h.browser.msie&&!document.namespaces.v&&document.namespaces.add("v","urn:schemas-microsoft-com:vml",
"#default#VML");if(h.browser.hasCanvas==undefined){var u=document.createElement("canvas");h.browser.hasCanvas=u.getContext!=undefined}u=function(){};u.prototype={init:function(b,a,c){this.width=b;this.height=a;this.target=c;if(c[0])c=c[0];c.vcanvas=this},drawShape:function(){alert("drawShape not implemented")},drawLine:function(b,a,c,d,f,e){return this.drawShape([[b,a],[c,d]],f,e)},drawCircle:function(){alert("drawCircle not implemented")},drawPieSlice:function(){alert("drawPieSlice not implemented")},
drawRect:function(){alert("drawRect not implemented")},getElement:function(){return this.canvas},_insert:function(b,a){h(a).html(b)}};var B=function(b,a,c){return this.init(b,a,c)};B.prototype=h.extend(new u,{_super:u.prototype,init:function(b,a,c){this._super.init(b,a,c);this.canvas=document.createElement("canvas");if(c[0])c=c[0];c.vcanvas=this;h(this.canvas).css({display:"inline-block",width:b,height:a,verticalAlign:"top"});this._insert(this.canvas,c);this.pixel_height=h(this.canvas).height();this.pixel_width=
h(this.canvas).width();this.canvas.width=this.pixel_width;this.canvas.height=this.pixel_height;h(this.canvas).css({width:this.pixel_width,height:this.pixel_height})},_getContext:function(b,a,c){var d=this.canvas.getContext("2d");if(b!=undefined)d.strokeStyle=b;d.lineWidth=c==undefined?1:c;if(a!=undefined)d.fillStyle=a;return d},drawShape:function(b,a,c,d){d=this._getContext(a,c,d);d.beginPath();d.moveTo(b[0][0]+0.5,b[0][1]+0.5);for(var f=1,e=b.length;f<e;f++)d.lineTo(b[f][0]+0.5,b[f][1]+0.5);a!=undefined&&
d.stroke();c!=undefined&&d.fill()},drawCircle:function(b,a,c,d,f){var e=this._getContext(d,f);e.beginPath();e.arc(b,a,c,0,2*Math.PI,false);d!=undefined&&e.stroke();f!=undefined&&e.fill()},drawPieSlice:function(b,a,c,d,f,e,g){var j=this._getContext(e,g);j.beginPath();j.moveTo(b,a);j.arc(b,a,c,d,f,false);j.lineTo(b,a);j.closePath();e!=undefined&&j.stroke();g&&j.fill()},drawRect:function(b,a,c,d,f,e){return this.drawShape([[b,a],[b+c,a],[b+c,a+d],[b,a+d],[b,a]],f,e)}});var C=function(b,a,c){return this.init(b,
a,c)};C.prototype=h.extend(new u,{_super:u.prototype,init:function(b,a,c){this._super.init(b,a,c);if(c[0])c=c[0];c.vcanvas=this;this.canvas=document.createElement("span");h(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:b,height:a,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,c);this.pixel_height=h(this.canvas).height();this.pixel_width=h(this.canvas).width();this.canvas.width=this.pixel_width;this.canvas.height=this.pixel_height;this.canvas.insertAdjacentHTML("beforeEnd",
'<v:group coordorigin="0 0" coordsize="'+this.pixel_width+" "+this.pixel_height+'" style="position:absolute;top:0;left:0;width:'+this.pixel_width+"px;height="+this.pixel_height+'px;"></v:group>');this.group=h(this.canvas).children()[0]},drawShape:function(b,a,c,d){for(var f=[],e=0,g=b.length;e<g;e++)f[e]=""+b[e][0]+","+b[e][1];b=f.splice(0,1);d=d==undefined?1:d;e=f[0]==f[f.length-1]?"x ":"";this.group.insertAdjacentHTML("beforeEnd",'<v:shape coordorigin="0 0" coordsize="'+this.pixel_width+" "+this.pixel_height+
'" '+(a==undefined?' stroked="false" ':' strokeWeight="'+d+'" strokeColor="'+a+'" ')+(c==undefined?' filled="false"':' fillColor="'+c+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixel_height+"px;width:"+this.pixel_width+'px;padding:0px;margin:0px;"  path="m '+b+" l "+f.join(", ")+" "+e+'e"> </v:shape>')},drawCircle:function(b,a,c,d,f){b-=c+1;a-=c+1;this.group.insertAdjacentHTML("beforeEnd","<v:oval "+(d==undefined?' stroked="false" ':' strokeWeight="1" strokeColor="'+
d+'" ')+(f==undefined?' filled="false"':' fillColor="'+f+'" filled="true" ')+' style="position:absolute;top:'+a+"px; left:"+b+"px; width:"+c*2+"px; height:"+c*2+'px"></v:oval>')},drawPieSlice:function(b,a,c,d,f,e,g){if(d!=f){if(f-d==2*Math.PI){d=0;f=2*Math.PI}var j=b+Math.round(Math.cos(d)*c),q=a+Math.round(Math.sin(d)*c),k=b+Math.round(Math.cos(f)*c),o=a+Math.round(Math.sin(f)*c);j==k&&q==o&&f-d<Math.PI||this.group.insertAdjacentHTML("beforeEnd",'<v:shape coordorigin="0 0" coordsize="'+this.pixel_width+
" "+this.pixel_height+'" '+(e==undefined?' stroked="false" ':' strokeWeight="1" strokeColor="'+e+'" ')+(g==undefined?' filled="false"':' fillColor="'+g+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixel_height+"px;width:"+this.pixel_width+'px;padding:0px;margin:0px;"  path="m '+b+","+a+" wa "+[b-c,a-c,b+c,a+c,j,q,k,o].join(", ")+' x e"> </v:shape>')}},drawRect:function(b,a,c,d,f,e){return this.drawShape([[b,a],[b,a+d],[b+c,a+d],[b+c,a],[b,a]],f,e)}})})(jQuery);
